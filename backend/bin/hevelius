#!/usr/bin/env python3

import sys
import subprocess
import argparse
from importlib.metadata import version as importlib_version

# This is ugly hack, but it allows running code from the local dir, without
# installing.
sys.path.append(".")

from hevelius.cmd_basic import stats, version, config_show
from hevelius.cmd_db_migrate import migrate
from hevelius import config


if __name__ == '__main__':
    print(f"Hevelius {importlib_version('hevelius')}")
    print()

    parser = argparse.ArgumentParser("hevelius")
    subparsers = parser.add_subparsers(help="commands", dest="command")

    stats_parser = subparsers.add_parser('stats', help="Show database statistics")
    migrate_parser = subparsers.add_parser('migrate', help="Migrate to the latest DB schema")
    version_parser = subparsers.add_parser('version', help="Shows the current DB schema version.")
    config_parser = subparsers.add_parser('config', help="Shows current DB configuration.")

    args = parser.parse_args()

    if args.command == "stats":
        stats(args)
    elif args.command == "migrate":
        migrate(args)
    elif args.command == "version":
        version(args)
    elif args.command == "config":
        config_show(args)

    else:
        parser.print_help()
